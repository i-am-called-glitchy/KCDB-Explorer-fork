<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>KCDB Explorer ‚Äî Kirka Chat Database</title>
  <meta name="description"
    content="Explore the Kirka.io Chat Database. Search messages, view user profiles, and analyze chat statistics.">
  <link rel="stylesheet" href="style.css">
</head>

<body>
  <!-- Loading overlay -->
  <div class="loading-overlay" id="loadingOverlay">
    <div class="loading-content">
      <div id="loadingMedia"></div>
      <div class="loading-text">Loading KCDB Explorer...</div>
    </div>
  </div>
  <script>
    // Randomly pick a loading animation on each refresh
    (function () {
      const media = [
        { type: 'img', src: 'loading.gif' },
        { type: 'video', src: 'loading2.mp4' },
      ];
      const pick = media[Math.floor(Math.random() * media.length)];
      const container = document.getElementById('loadingMedia');
      if (pick.type === 'img') {
        const img = document.createElement('img');
        img.src = pick.src;
        img.alt = 'Loading...';
        img.className = 'loading-gif';
        container.appendChild(img);
      } else {
        const vid = document.createElement('video');
        vid.src = pick.src;
        vid.autoplay = true;
        vid.loop = true;
        vid.muted = true;
        vid.playsInline = true;
        vid.className = 'loading-gif';
        container.appendChild(vid);
      }
    })();
  </script>

  <!-- Mobile menu toggle -->
  <button class="mobile-toggle" id="mobileToggle" aria-label="Toggle menu">‚ò∞</button>
  <div class="sidebar-backdrop" id="sidebarBackdrop"></div>

  <div class="app-layout">

    <!-- Sidebar -->
    <aside class="sidebar" id="sidebar">
      <div class="sidebar-logo">
        <div class="logo-icon">K</div>
        <span class="logo-text">KCDB Explorer</span>
      </div>

      <div class="sidebar-section-label">Navigate</div>

      <button class="sidebar-item active" data-view="dashboard" id="nav-dashboard">
        <span class="item-icon">üìä</span>
        Dashboard
      </button>

      <button class="sidebar-item" data-view="search" id="nav-search">
        <span class="item-icon">üîç</span>
        Search Messages
      </button>

      <button class="sidebar-item" data-view="user" id="nav-user" style="display:none">
        <span class="item-icon">üë§</span>
        <span id="nav-user-label">User Profile</span>
      </button>

      <button class="sidebar-item" data-view="about" id="nav-about">
        <span class="item-icon">üìñ</span>
        About / API Docs
      </button>

      <div class="sidebar-footer">
        Made by Glitchy's boyfriend<br>
        and future husband<br>
        <strong>Energyboy</strong> :3 ‚ù§Ô∏è<br>
        <span style="margin-top:6px;display:block">KCDB by <a href="https://amcalledglitchy.dev"
            target="_blank">amcalledglitchy</a></span>
      </div>
    </aside>

    <!-- Main content -->
    <main class="main-content" id="mainContent">

      <!-- ========== DASHBOARD ========== -->
      <div class="view active" id="view-dashboard">
        <div class="page-header">
          <h1>Dashboard</h1>
          <p>Live statistics from the Kirka Chat Database</p>
        </div>

        <div class="stats-grid" id="statsGrid">
          <div class="stat-card accent">
            <div class="stat-label"><span class="stat-icon">üí¨</span> Total Messages</div>
            <div class="stat-value" id="stat-total">
              <div class="skeleton skeleton-value"></div>
            </div>
          </div>
          <div class="stat-card success">
            <div class="stat-label"><span class="stat-icon">üìÖ</span> Today</div>
            <div class="stat-value" id="stat-today">
              <div class="skeleton skeleton-value"></div>
            </div>
          </div>
          <div class="stat-card warning">
            <div class="stat-label"><span class="stat-icon">üìÜ</span> Yesterday</div>
            <div class="stat-value" id="stat-yesterday">
              <div class="skeleton skeleton-value"></div>
            </div>
          </div>
          <div class="stat-card purple">
            <div class="stat-label"><span class="stat-icon">‚è∞</span> This Hour</div>
            <div class="stat-value" id="stat-hour">
              <div class="skeleton skeleton-value"></div>
            </div>
          </div>
          <div class="stat-card">
            <div class="stat-label"><span class="stat-icon">üìä</span> Daily Average</div>
            <div class="stat-value" id="stat-avg">
              <div class="skeleton skeleton-value"></div>
            </div>
          </div>
          <div class="stat-card">
            <div class="stat-label"><span class="stat-icon">üë•</span> Active Users</div>
            <div class="stat-value" id="stat-users">
              <div class="skeleton skeleton-value"></div>
            </div>
            <div class="stat-sub" id="stat-sample"></div>
          </div>
        </div>

        <div class="section-block" style="margin-bottom:20px">
          <div class="section-title"><span class="section-icon">üìà</span> Hourly Activity (Last 48h)</div>
          <div class="chart-container" style="height:220px"><canvas id="chartHourly"></canvas></div>
        </div>

        <div class="charts-row">
          <div class="section-block">
            <div class="section-title"><span class="section-icon">üìÖ</span> Daily Messages</div>
            <div class="chart-container"><canvas id="chartDaily"></canvas></div>
          </div>
          <div class="section-block">
            <div class="section-title"><span class="section-icon">üè∑Ô∏è</span> Message Types</div>
            <div class="chart-container"><canvas id="chartTypes"></canvas></div>
          </div>
        </div>

        <div class="charts-row">
          <div class="section-block">
            <div class="section-title"><span class="section-icon">üèÜ</span> Top Users (Recent)</div>
            <div class="top-users-list" id="topUsersList">
              <div class="loading-screen">
                <div class="spinner"></div>
              </div>
            </div>
          </div>
          <div class="section-block">
            <div class="section-title"><span class="section-icon">‚ö°</span> Recent Activity</div>
            <div class="activity-feed" id="activityFeed">
              <div class="loading-screen">
                <div class="spinner"></div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- ========== SEARCH ========== -->
      <div class="view" id="view-search">
        <div class="page-header">
          <h1>Search Messages</h1>
          <p>Query the database with any combination of filters</p>
        </div>

        <div class="search-form">
          <div class="form-grid">
            <div class="form-group">
              <label for="s-username">Username</label>
              <input type="text" id="s-username" placeholder="Partial match‚Ä¶">
            </div>
            <div class="form-group">
              <label for="s-userid">User ID</label>
              <input type="text" id="s-userid" placeholder="Full UUID‚Ä¶">
            </div>
            <div class="form-group">
              <label for="s-shortid">Short ID</label>
              <input type="text" id="s-shortid" placeholder="e.g. AVX3NA">
            </div>
            <div class="form-group">
              <label for="s-message">Message (exact)</label>
              <input type="text" id="s-message" placeholder="Exact full message‚Ä¶">
            </div>
            <div class="form-group">
              <label for="s-contains">Message Contains</label>
              <input type="text" id="s-contains" placeholder="word1;word2;word3">
            </div>
            <div class="form-group">
              <label for="s-exactid">Exact ID</label>
              <input type="number" id="s-exactid" placeholder="Message ID">
            </div>
            <div class="form-group">
              <label for="s-sinceid">Since ID</label>
              <input type="number" id="s-sinceid" placeholder="After this ID‚Ä¶">
            </div>
            <div class="form-group">
              <label for="s-beforeid">Before ID</label>
              <input type="number" id="s-beforeid" placeholder="Before this ID‚Ä¶">
            </div>
            <div class="form-group">
              <label for="s-limit">Limit</label>
              <select id="s-limit">
                <option value="25">25</option>
                <option value="50">50</option>
                <option value="100" selected>100</option>
                <option value="250">250</option>
                <option value="500">500</option>
                <option value="1000">1000</option>
              </select>
            </div>
          </div>
          <div class="form-actions">
            <button class="btn btn-primary" id="searchBtn">üîç Search</button>
            <button class="btn btn-secondary" id="clearBtn">Clear</button>
          </div>
        </div>

        <div id="searchResults">
          <div class="empty-state">
            <div class="empty-icon">üîé</div>
            <p>Enter filters above and hit Search to explore the database</p>
          </div>
        </div>
      </div>

      <!-- ========== USER PROFILE ========== -->
      <div class="view" id="view-user">
        <button class="back-link" id="backFromUser">‚Üê Back to Search</button>
        <div class="user-profile-header" id="userProfileHeader"></div>
        <div class="stats-grid" id="userStatsGrid"></div>
        <div class="section-block">
          <div class="section-title"><span class="section-icon">üí¨</span> Message History</div>
          <div id="userMessages">
            <div class="loading-screen">
              <div class="spinner"></div>
            </div>
          </div>
        </div>
      </div>

      <!-- ========== CONTEXT VIEW ========== -->
      <div class="view" id="view-context">
        <button class="back-link" id="backFromContext">‚Üê Back to Search</button>
        <div class="page-header">
          <h1>Message Context</h1>
          <p>Viewing surrounding messages</p>
        </div>
        <div class="context-list full-page" id="contextList"></div>
      </div>

      <!-- ========== ABOUT ========== -->
      <div class="view" id="view-about">
        <div class="page-header">
          <h1>About KCDB</h1>
          <p>Kirka Chat Database ‚Äî API documentation and info</p>
        </div>

        <div class="about-block">
          <h3>What is KCDB?</h3>
          <p>KCDB (Kirka Chat DataBase) is a third-party database that logs public chat messages from <a
              href="https://kirka.io" target="_blank">Kirka.io</a>. It is maintained by <a
              href="https://amcalledglitchy.dev" target="_blank">amcalledglitchy.dev</a>.</p>
        </div>

        <div class="about-block">
          <h3>API Base URL</h3>
          <p><code>https://kcdb.amcalledglitchy.dev</code></p>
        </div>

        <div class="about-block">
          <h3>Endpoint: <code>/api/messages</code></h3>
          <p>Retrieve a list of messages based on various filters. Results are always returned in descending order (newest first).</p>
          <p><strong>Cache Duration:</strong> 5 seconds.</p>

          <h4>Query Parameters</h4>
          <table class="endpoint-table">
            <thead>
              <tr>
                <th>Parameter</th>
                <th>Type</th>
                <th>Description</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td><code>user_id</code></td>
                <td>String</td>
                <td>Full user ID (exact match)</td>
              </tr>
              <tr>
                <td><code>short_id</code></td>
                <td>String</td>
                <td>User's short ID (exact match)</td>
              </tr>
              <tr>
                <td><code>user_name</code></td>
                <td>String</td>
                <td>Username (partial match supported, e.g., <code>abc</code> matches <code>abcdef</code>)</td>
              </tr>
              <tr>
                <td><code>since_id</code></td>
                <td>Integer</td>
                <td>Messages with an ID <strong>greater than</strong> this value (Newer history)</td>
              </tr>
              <tr>
                <td><code>before_id</code></td>
                <td>Integer</td>
                <td>Messages with an ID <strong>lower than</strong> this value (Older history)</td>
              </tr>
              <tr>
                <td><code>exact_id</code></td>
                <td>Integer</td>
                <td>Message with this exact ID (overrides <code>since_id</code>/<code>before_id</code>)</td>
              </tr>
              <tr>
                <td><code>limit</code></td>
                <td>Integer</td>
                <td>Number of results (1‚Äì1000, default: 100)</td>
              </tr>
              <tr>
                <td><code>message</code></td>
                <td>String</td>
                <td>Exact full message string match</td>
              </tr>
              <tr>
                <td><code>message_contains</code></td>
                <td>String</td>
                <td>Ordered keyword search separated by <code>;</code></td>
              </tr>
              <tr>
                <td><code>message_type</code></td>
                <td>Integer</td>
                <td>Filter by message type (2 = Chat, 13 = Trade). Type 3 (bulk/history) messages are processed individually, so querying for type 3 yields no results.</td>
              </tr>
            </tbody>
          </table>

          <h4>Response Structure</h4>
          <p>Returns an object containing the total count and an array of message objects.</p>
          <table class="endpoint-table">
            <thead>
              <tr>
                <th>Key</th>
                <th>Type</th>
                <th>Description</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td><code>count</code></td>
                <td>Integer</td>
                <td>Number of messages returned (limited by <code>limit</code>)</td>
              </tr>
              <tr>
                <td><code>results</code></td>
                <td>Array</td>
                <td>List of message objects (see fields below)</td>
              </tr>
            </tbody>
          </table>

          <h4>Message Object Fields</h4>
          <table class="endpoint-table">
            <thead>
              <tr>
                <th>Field</th>
                <th>Type</th>
                <th>Description</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td><code>id</code></td>
                <td>Integer</td>
                <td>Unique database ID</td>
              </tr>
              <tr>
                <td><code>hash</code></td>
                <td>String</td>
                <td>Sha256 verification hash</td>
              </tr>
              <tr>
                <td><code>user_id</code></td>
                <td>String</td>
                <td>Sender's full unique identifier</td>
              </tr>
              <tr>
                <td><code>user_short_id</code></td>
                <td>String</td>
                <td>Sender's public short ID</td>
              </tr>
              <tr>
                <td><code>user_name</code></td>
                <td>String</td>
                <td>Sender's username at time of recording</td>
              </tr>
              <tr>
                <td><code>user_role</code></td>
                <td>String</td>
                <td>User role (e.g., USER, BOT, ADMIN)</td>
              </tr>
              <tr>
                <td><code>user_level</code></td>
                <td>Integer</td>
                <td>In-game user level</td>
              </tr>
              <tr>
                <td><code>message</code></td>
                <td>String</td>
                <td>Message content</td>
              </tr>
              <tr>
                <td><code>type</code></td>
                <td>Integer</td>
                <td>Channel/Message type (e.g., 1=Global, 2=Trade)</td>
              </tr>
              <tr>
                <td><code>received_at</code></td>
                <td>String</td>
                <td>Timestamp (YYYY-MM-DD HH:MM:SS)</td>
              </tr>
            </tbody>
          </table>
        </div>

        <div class="about-block">
          <h3>Endpoint: <code>/api/stats</code></h3>
          <p>Retrieve global and recent chat statistics, including message counts, user rankings, and activity timelines.</p>
          <p>Complex metrics (unique users, type counts, top users) are calculated using the <strong>most recent 60,000 messages</strong>.</p>
          <p><strong>Cache Duration:</strong> 60 seconds.</p>

          <h4>Response Structure</h4>
          <table class="endpoint-table">
            <thead>
              <tr>
                <th>Key</th>
                <th>Type</th>
                <th>Description</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td><code>totalMessages</code></td>
                <td>Integer</td>
                <td>Absolute total number of messages in the database</td>
              </tr>
              <tr>
                <td><code>sampleSize</code></td>
                <td>Integer</td>
                <td>Number of recent messages used for complex stats</td>
              </tr>
              <tr>
                <td><code>today</code></td>
                <td>Object</td>
                <td>Contains <code>date</code> and message <code>count</code> for current UTC day</td>
              </tr>
              <tr>
                <td><code>yesterday</code></td>
                <td>Object</td>
                <td>Contains <code>date</code> and message <code>count</code> for previous UTC day</td>
              </tr>
              <tr>
                <td><code>thisHour</code></td>
                <td>Integer</td>
                <td>Messages sent in the last 60 minutes</td>
              </tr>
              <tr>
                <td><code>uniqueUsers</code></td>
                <td>Integer</td>
                <td>Total unique users within the <code>sampleSize</code></td>
              </tr>
              <tr>
                <td><code>avgDaily</code></td>
                <td>Integer</td>
                <td>Average messages per day (based on yesterday)</td>
              </tr>
              <tr>
                <td><code>dayCounts</code></td>
                <td>Object</td>
                <td>Key-value pairs of dates and message counts</td>
              </tr>
              <tr>
                <td><code>hourlyTimeline</code></td>
                <td>Array</td>
                <td>Message counts grouped by hour (last 36h)</td>
              </tr>
              <tr>
                <td><code>typeCounts</code></td>
                <td>Object</td>
                <td>Breakdown of message types within sample</td>
              </tr>
              <tr>
                <td><code>topUsers</code></td>
                <td>Array</td>
                <td>Top 15 most active users in sample</td>
              </tr>
              <tr>
                <td><code>recentMessages</code></td>
                <td>Array</td>
                <td>The 20 most recently sent messages</td>
              </tr>
            </tbody>
          </table>
        </div>

        <div class="about-block">
          <h3>Hash Verification Information</h3>
          <p>Messages include a SHA-256 hash for verification. Details on the hashing process:</p>
          <ul>
            <li><strong>Genesis hash:</strong> 64 zeros (<code>"0"*64</code>).</li>
            <li><strong>Algorithm:</strong> SHA-256.</li>
            <li><strong>Encoding:</strong> The final concatenated string is encoded as UTF-8 before hashing.</li>
            <li><strong>Default NULL value:</strong> "None".</li>
            <li><strong>Type Conversion:</strong> Non-string values (integers like <code>user_level</code>) are converted to base-10 strings.</li>
            <li><strong>Canonical Format:</strong><br>
              <code>prev_hash|user_id|user_short_id|user_name|user_role|user_level|message|type|received_at</code>
            </li>
          </ul>
        </div>

        <div class="about-block">
          <h3>Credits</h3>
          <ul>
            <li><strong>KCDB Explorer</strong> made by Glitchy's boyfriend and future husband <strong>Energyboy</strong>
              :3 ‚ù§Ô∏è</li>
            <li><strong>KCDB</strong> (Kirka Chat DataBase) made by <strong>Glitchy</strong> (<a
                href="https://amcalledglitchy.dev" target="_blank">amcalledglitchy</a>)</li>
          </ul>
        </div>

        <div class="about-block">
          <h3>Disclaimers</h3>
          <ul>
            <li>The maintainer is voluntarily and loosely affiliated with the Kirka.io staff team; however, KCDB is an <strong>independently operated</strong> project.</li>
            <li>The maintainer does not claim liability unless explicitly required by law.</li>
            <li>Please don't abuse the API. If you require a full database dump, please contact the maintainer nicely via Discord or email.</li>
          </ul>
        </div>
      </div>

  <!-- Message Context Modal -->
  <!-- REMOVED -->

  <!-- Toast notification -->
  <div class="toast" id="toast"></div>

  <script src="app.js"></script>
<script defer src="https://static.cloudflareinsights.com/beacon.min.js/vcd15cbe7772f49c399c6a5babf22c1241717689176015" integrity="sha512-ZpsOmlRQV6y907TI0dKBHq9Md29nnaEIPlkf84rnaERnq6zvWvPUqr2ft8M1aS28oN72PdrCzSjY4U6VaAw1EQ==" data-cf-beacon='{"version":"2024.11.0","token":"b8f7534acd114424a754676c33eeafbf","r":1,"server_timing":{"name":{"cfCacheStatus":true,"cfEdge":true,"cfExtPri":true,"cfL4":true,"cfOrigin":true,"cfSpeedBrain":true},"location_startswith":null}}' crossorigin="anonymous"></script>
</body>

</html>
